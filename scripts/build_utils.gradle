
apply plugin: 'tvkit.common.tools'

//生成task的组名称
if(!ext.hasProperty("taskGroup") || ext.getProperty("taskGroup") == null ){
    project.ext.setProperty("taskGroup","tvkit")
}

String exe(String s){
    return s.execute([],project.rootDir).text.trim()
}

println("name is "+name+" displayName is "+displayName)

def savePropertiesFile(Properties p,File file){

    FileOutputStream outputStream = new FileOutputStream(file,false)

    StringBuilder sb = new StringBuilder()
    sb.append("Aoto generated by mavenGenerateProperties task")
    //TODO 添加注释


    p.store(outputStream,sb.toString())

}

Properties loadProperties(File file){
    FileInputStream inputStream = new FileInputStream(file)
    java.util.Properties p = new Properties()
    p.load(inputStream)
    return p
}

/**
 * 获取自增的版本号，比如传1.0.0，返回1.0.1
 * @param current
 * @return
 */
static String buildIncrementVersion(String current){
    final int lastIndex = current.lastIndexOf('.') + 1
    final String prefix = current.substring(0,lastIndex)
    final int lastNumber = Integer.parseInt(current.substring(lastIndex));
    final int finalNumber = lastNumber + 1
    final String result = prefix + finalNumber
    System.out.println("buildIncrementVersion currentVersion "+ current+" nextVersion:"+result);
    return result
}

static String buildVersionByPost(String current,String post){

    final int lastIndex = current.lastIndexOf('.') + 1
    final String prefix = current.substring(0,lastIndex)
    final String finalNumber = post
    final String result = prefix + finalNumber
    System.out.println("buildIncrementVersion currentVersion "+ current+" nextVersion:"+result)
    return result
}



//task mavenGenerateProperties{
//    group getProperty("taskGroup")
//    doFirst {
//        File file = new File(project.projectDir,"maven.properties")
//        if(file.exists()){
//            throw new RuntimeException("maven.properties已经存在，无需创建！")
//        }
//
//        java.util.Properties p = new Properties()
//        p.setMetaClass()
//        p.put("mavenGroupId",project.group)
//        p.put("mavenVersion","1.0.0")
//        p.put("mavenArtifactId",project.name)
//        p.put("snapshot","true")
//
//        println("generateMavenProperties Properties : "+p)
//
//        println("generateMavenProperties file path is "+file)
//        file.createNewFile()
//
//        exe('git add '+file.absolutePath)
//        savePropertiesFile(p,file)
//    }
//
//}



